<!DOCTYPE html>
<html>
<head>
    <title>Mind Orbit - Emotional Cosmic Survival</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            color: #fff;
        }
        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: #000;
        }
        #loading-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background: black;
            color: #0f0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        #tagline {
            font-size: 24px;
            color: #0ff;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }
        #username-input {
            padding: 10px;
            margin: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #0ff;
            color: white;
            font-size: 18px;
            outline: none;
        }
        #start-btn {
            padding: 10px 20px;
            margin: 10px;
            background: #0ff;
            color: black;
            border: none;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
        }
        #start-btn:hover {
            background: #0aa;
            transform: scale(1.05);
        }
        #chat-container {
            position: absolute;
            bottom: 10px;
            left: 10px;
            width: 250px;
            height: 150px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #0ff;
            display: none;
        }
        #chat-messages {
            height: 120px;
            overflow-y: auto;
            padding: 5px;
        }
        .chat-message {
            margin: 3px 0;
            font-size: 12px;
            color: #fff;
        }
        #chat-buttons {
            display: flex;
            justify-content: space-around;
        }
        .chat-btn {
            flex: 1;
            padding: 3px;
            margin: 2px;
            background: rgba(0, 255, 255, 0.3);
            border: none;
            color: white;
            font-size: 10px;
            cursor: pointer;
        }
        #game-over {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #game-over h1 {
            color: #ff0000;
            font-size: 48px;
            margin-bottom: 20px;
        }
        #game-over p {
            color: #fff;
            font-size: 24px;
            margin: 10px 0;
            text-align: center;
        }
        #restart-btn {
            padding: 10px 20px;
            margin-top: 20px;
            background: #00ff00;
            color: black;
            border: none;
            font-size: 18px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <h1>MIND ORBIT</h1>
        <div id="tagline">Sobrevive tus emociones en un caos cósmico.<br>Patrocinado por [Marca]</div>
        <input id="username-input" type="text" placeholder="Tu nombre (max 10 caracteres)" maxlength="10">
        <button id="start-btn">¡COMENZAR!</button>
    </div>
    
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    
    <div id="chat-container">
        <div id="chat-messages"></div>
        <div id="chat-buttons">
            <button class="chat-btn" data-message="¡Casi!">¡Casi!</button>
            <button class="chat-btn" data-message="¡Boom!">¡Boom!</button>
            <button class="chat-btn" data-message="¡Suerte!">¡Suerte!</button>
            <button class="chat-btn" data-message="¡Ayuda!">¡Ayuda!</button>
        </div>
    </div>

    <div id="game-over">
        <h1>GAME OVER</h1>
        <p id="final-score">Puntuación Final: 0</p>
        <p id="time-survived">Tiempo Sobrevivido: 0 segundos</p>
        <p>Top 5: 1. NelsonP - 500 | 2. GrokFan - 450 | 3. StarGirl - 400 | 4. OrbitKing - 350 | 5. MindWave - 300</p>
        <button id="restart-btn">JUGAR DE NUEVO</button>
    </div>

    <script>
        let canvas, ctx;
        let username = 'Jugador';
        let gameStarted = false;
        let gameOver = false;
        let score = 0;
        let timeSurvived = 0;
        let stability = 100; // Aumentado a 100
        let gameTime = 0;
        
        let ship = { x: 100, y: 300, width: 20, height: 20, velocity: 0 };
        let planets = [];
        let energies = [];
        let stars = [];
        let otherPlayers = [];
        
        const planetTypes = [
            { name: 'anger', color: '#ff0000', shape: 'rectangle', damage: 15 },
            { name: 'fear', color: '#9932cc', shape: 'circle', damage: 10 },
            { name: 'joy', color: '#ffff00', shape: 'star', damage: 5 }
        ];
        
        const eventTypes = [
            { name: 'memeRain', text: '¡Lluvia de memes! by TikTok', duration: 3000 },
            { name: 'cosmicScream', text: '¡AHHHHH! by Monster', duration: 1500 },
            { name: 'dramaPlanet', text: '¡No eres suficiente! by Netflix', duration: 4000 }
        ];
        
        let activeEvent = null;
        let eventTimer = 0;
        let nextEventTime = 15000;
        let message = '';
        let messageTimer = 0;
        
        let lastTime = 0;
        let animationId;
        
        const playerNames = ['NelsonP', 'GrokFan', 'EmoDancer', 'CosmicJohn', 'StarGirl', 'NebulaX', 'OrbitKing', 'MindWave'];
        
        document.getElementById('start-btn').addEventListener('click', function() {
            username = document.getElementById('username-input').value.trim() || 'Jugador';
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('chat-container').style.display = 'block';
            gameStarted = true;
            initGame();
        });
        
        document.querySelectorAll('.chat-btn').forEach(button => {
            button.addEventListener('click', function() {
                if (gameStarted) addChatMessage(username + ': ' + this.dataset.message);
            });
        });
        
        document.getElementById('restart-btn').addEventListener('click', function() {
            document.getElementById('game-over').style.display = 'none';
            gameOver = false;
            stability = 100;
            score = 0;
            timeSurvived = 0;
            gameTime = 0;
            planets = []; // Resetear planetas
            energies = []; // Resetear energías
            initGame();
        });
        
        function addChatMessage(message) {
            const chatMessages = document.getElementById('chat-messages');
            const messageElement = document.createElement('div');
            messageElement.className = 'chat-message';
            messageElement.textContent = message;
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            if (chatMessages.children.length > 10) chatMessages.removeChild(chatMessages.children[0]);
        }
        
        function initGame() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            ship.y = canvas.height / 2;
            ship.velocity = 0;
            stars = [];
            otherPlayers = [];
            createStars();
            createPlanets();
            createEnergies();
            createOtherPlayers();
            addChatMessage('Sistema: ¡Bienvenido a Mind Orbit, ' + username + '!');
            document.addEventListener('keydown', handleKeyDown);
            canvas.addEventListener('click', handleClick);
            lastTime = performance.now();
            gameLoop();
        }
        
        function createStars() {
            for (let i = 0; i < 50; i++) { // Reducido a 50
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 1.5 + 0.5,
                    alpha: Math.random() * 0.7 + 0.3,
                    twinkle: Math.random() < 0.3,
                    twinkleSpeed: Math.random() * 0.01 + 0.005
                });
            }
        }
        
        function createPlanets() {
            for (let i = 0; i < 3; i++) { // Reducido a 3
                createPlanet();
            }
        }
        
        function createPlanet() {
            const type = planetTypes[Math.floor(Math.random() * planetTypes.length)];
            planets.push({
                x: canvas.width + Math.random() * 400,
                y: 100 + Math.random() * (canvas.height - 200),
                radius: 20 + Math.random() * 20,
                width: 40 + Math.random() * 30,
                height: 40 + Math.random() * 30,
                speed: 1 + Math.random() * 1.5,
                type: type,
                rotation: 0,
                rotationSpeed: (Math.random() - 0.5) * 0.02
            });
        }
        
        function createEnergies() {
            for (let i = 0; i < 3; i++) { // Reducido a 3
                createEnergy();
            }
        }
        
        function createEnergy() {
            energies.push({
                x: canvas.width + Math.random() * 300,
                y: 100 + Math.random() * (canvas.height - 200),
                radius: 8,
                speed: 1.5 + Math.random() * 1,
                value: 5,
                glow: 0.6
            });
        }
        
        function createOtherPlayers() {
            for (let i = 0; i < 5; i++) { // Reducido a 5
                otherPlayers.push({
                    id: 'player_' + i,
                    name: playerNames[Math.floor(Math.random() * playerNames.length)] + i,
                    x: Math.random() * canvas.width,
                    y: 100 + Math.random() * (canvas.height - 200),
                    stability: 20 + Math.random() * 80,
                    explosion: false,
                    explosionTime: 0
                });
            }
        }
        
        function handleKeyDown(e) {
            if (e.code === 'Space') stabilizeShip();
        }
        
        function handleClick() {
            stabilizeShip();
        }
        
        function stabilizeShip() {
            if (!gameOver) ship.velocity = -6;
        }
        
        function gameLoop(timestamp) {
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;
            gameTime += deltaTime;
            update(deltaTime);
            render();
            if (!gameOver) animationId = requestAnimationFrame(gameLoop);
        }
        
        function update(deltaTime) {
            timeSurvived = Math.floor(gameTime / 1000);
            score = timeSurvived + Math.floor(stability);
            ship.velocity += 0.2;
            ship.y += ship.velocity;
            if (ship.y < 20) ship.y = 20;
            if (ship.y > canvas.height - 20) ship.y = canvas.height - 20;
            updatePlanets();
            updateEnergies();
            updateOtherPlayers();
            checkCollisions();
            stability -= 0.005; // Reducido a 0.005
            if (stability > 100) stability = 100;
            if (stability <= 0) {
                stability = 0;
                gameOver = true;
                showGameOver();
            }
            if (messageTimer > 0) {
                messageTimer -= deltaTime;
                if (messageTimer <= 0) message = '';
            }
            if (eventTimer > 0) {
                eventTimer -= deltaTime;
                if (eventTimer <= 0) activeEvent = null;
            } else if (gameTime >= nextEventTime) {
                triggerRandomEvent();
                nextEventTime = gameTime + 15000 + Math.random() * 15000;
            }
        }
        
        function updatePlanets() {
            for (let i = planets.length - 1; i >= 0; i--) {
                const planet = planets[i];
                planet.x -= planet.speed;
                planet.rotation += planet.rotationSpeed;
                if (planet.x < -50) {
                    planets.splice(i, 1);
                    createPlanet();
                }
            }
        }
        
        function updateEnergies() {
            for (let i = energies.length - 1; i >= 0; i--) {
                const energy = energies[i];
                energy.x -= energy.speed;
                energy.glow = 0.6 + Math.sin(gameTime / 300) * 0.4;
                if (energy.x < -20) {
                    energies.splice(i, 1);
                    createEnergy();
                }
            }
        }
        
        function updateOtherPlayers() {
            for (let i = 0; i < otherPlayers.length; i++) {
                const player = otherPlayers[i];
                player.x += (Math.random() * 2 - 0.5);
                if (Math.random() < 0.05) player.y += Math.random() < 0.5 ? -20 : 10;
                if (player.x > canvas.width) player.x = 0;
                if (player.y < 50) player.y = 50;
                if (player.y > canvas.height - 50) player.y = canvas.height - 50;
                player.stability -= 0.01;
                if (Math.random() < 0.01) player.stability += 5;
                if (player.stability <= 0 || (Math.random() < 0.0005 && !player.explosion)) {
                    player.explosion = true;
                    player.explosionTime = gameTime;
                    player.stability = 0;
                    if (Math.random() < 0.5) addChatMessage(player.name + ': ¡Boom!');
                }
                if (player.explosion && gameTime - player.explosionTime > 2000) {
                    player.explosion = false;
                    player.x = 0;
                    player.stability = 50;
                }
            }
        }
        
        function checkCollisions() {
            for (let i = 0; i < planets.length; i++) {
                const planet = planets[i];
                if (ship.x + ship.width > planet.x - planet.width/2 &&
                    ship.x < planet.x + planet.width/2 &&
                    ship.y + ship.height > planet.y - planet.height/2 &&
                    ship.y < planet.y + planet.height/2) {
                    stability -= planet.type.damage;
                    if (stability < 0) stability = 0;
                    message = '¡' + capitalize(planet.type.name) + '! -' + planet.type.damage;
                    messageTimer = 1000;
                    if (Math.random() < 0.3) {
                        const messages = ['¡Auch!', '¡Eso dolió!', 'Cuidado...'];
                        addChatMessage(username + ': ' + messages[Math.floor(Math.random() * messages.length)]);
                    }
                    planet.x += 50;
                }
            }
            for (let i = energies.length - 1; i >= 0; i--) {
                const energy = energies[i];
                const dx = ship.x + ship.width/2 - energy.x;
                const dy = ship.y + ship.height/2 - energy.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance < ship.width/2 + energy.radius) {
                    stability += energy.value;
                    if (stability > 100) stability = 100;
                    score += 50;
                    message = '+' + energy.value + ' Energía\n+50 Puntos';
                    messageTimer = 1000;
                    if (Math.random() < 0.2) {
                        const messages = ['¡Energía!', '+5 💙', '¡Recarga!'];
                        addChatMessage(username + ': ' + messages[Math.floor(Math.random() * messages.length)]);
                    }
                    energies.splice(i, 1);
                    createEnergy();
                }
            }
        }
        
        function triggerRandomEvent() {
            const event = eventTypes[Math.floor(Math.random() * eventTypes.length)];
            activeEvent = event;
            eventTimer = event.duration;
            message = event.text;
            messageTimer = event.duration;
            addChatMessage('Sistema: ' + event.text);
            if (event.name === 'cosmicScream') ship.velocity = Math.random() * 10 - 5;
        }
        
        function render() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            drawStars();
            drawOtherPlayers();
            drawPlanets();
            drawEnergies();
            drawShip();
            drawUI();
            if (activeEvent) drawEventEffects();
            if (message && messageTimer > 0) drawMessage();
        }
        
        function drawStars() {
            for (let i = 0; i < stars.length; i++) {
                const star = stars[i];
                let alpha = star.alpha;
                if (star.twinkle) {
                    alpha = star.alpha + Math.sin(gameTime * star.twinkleSpeed) * 0.3;
                    alpha = Math.max(0.1, Math.min(1.0, alpha));
                }
                ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                ctx.fill();
                star.x -= 0.1;
                if (star.x < 0) star.x = canvas.width;
            }
        }
        
        function drawPlanets() {
            for (let i = 0; i < planets.length; i++) {
                const planet = planets[i];
                ctx.save();
                ctx.translate(planet.x, planet.y);
                ctx.rotate(planet.rotation);
                if (planet.type.shape === 'rectangle') {
                    ctx.fillStyle = planet.type.color;
                    ctx.fillRect(-planet.width/2, -planet.height/2, planet.width, planet.height);
                    if (planet.type.name === 'anger') {
                        ctx.strokeStyle = planet.type.color;
                        ctx.lineWidth = 3;
                        for (let j = 0; j < 8; j++) {
                            const angle = (j / 8) * Math.PI * 2;
                            ctx.beginPath();
                            ctx.moveTo(0, 0);
                            ctx.lineTo(Math.cos(angle) * (planet.width/2 + 10), Math.sin(angle) * (planet.height/2 + 10));
                            ctx.stroke();
                        }
                    }
                } else if (planet.type.shape === 'circle') {
                    ctx.fillStyle = planet.type.color;
                    ctx.beginPath();
                    ctx.arc(0, 0, planet.radius, 0, Math.PI * 2);
                    ctx.fill();
                } else if (planet.type.shape === 'star') {
                    drawStar(0, 0, 5, planet.radius, planet.radius * 0.4, planet.type.color);
                }
                ctx.restore();
            }
        }
        
        function drawStar(x, y, points, outerRadius, innerRadius, color) {
            ctx.fillStyle = color;
            ctx.beginPath();
            for (let i = 0; i < points * 2; i++) {
                const radius = i % 2 === 0 ? outerRadius : innerRadius;
                const angle = (i / (points * 2)) * Math.PI * 2;
                const px = x + Math.cos(angle) * radius;
                const py = y + Math.sin(angle) * radius;
                if (i === 0) ctx.moveTo(px, py);
                else ctx.lineTo(px, py);
            }
            ctx.closePath();
            ctx.fill();
        }
        
        function drawEnergies() {
            for (let i = 0; i < energies.length; i++) {
                const energy = energies[i];
                ctx.fillStyle = `rgba(0, 255, 255, ${energy.glow * 0.3})`;
                ctx.beginPath();
                ctx.arc(energy.x, energy.y, energy.radius + 5, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = `rgba(0, 255, 255, ${energy.glow})`;
                ctx.beginPath();
                ctx.arc(energy.x, energy.y, energy.radius, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        function drawShip() {
            const color = getStabilityColor(stability);
            ctx.fillStyle = color.replace('rgb', 'rgba').replace(')', ', 0.3)');
            ctx.beginPath();
            ctx.moveTo(ship.x, ship.y);
            ctx.lineTo(ship.x + ship.width, ship.y + ship.height/2);
            ctx.lineTo(ship.x, ship.y + ship.height);
            ctx.closePath();
            ctx.fill();
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(ship.x, ship.y);
            ctx.lineTo(ship.x + ship.width, ship.y + ship.height/2);
            ctx.lineTo(ship.x, ship.y + ship.height);
            ctx.closePath();
            ctx.stroke();
            ctx.fillStyle = '#fff';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(username, ship.x + ship.width/2, ship.y - 10);
        }
        
        function drawOtherPlayers() {
            for (let i = 0; i < otherPlayers.length; i++) {
                const player = otherPlayers[i];
                if (player.x >= 0 && player.x <= canvas.width) {
                    const color = getStabilityColor(player.stability);
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(player.x, player.y);
                    ctx.lineTo(player.x + 20, player.y + 10);
                    ctx.lineTo(player.x, player.y + 20);
                    ctx.closePath();
                    ctx.stroke();
                    ctx.fillStyle = '#fff';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    if (player.explosion) {
                        const size = Math.min(1, (gameTime - player.explosionTime) / 500) * 20;
                        ctx.fillStyle = '#ff0';
                        ctx.beginPath();
                        ctx.arc(player.x + 10, player.y + 10, size, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = '#f00';
                        ctx.beginPath();
                        ctx.arc(player.x + 10, player.y + 10, size * 0.7, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillText(player.name + ' 💥', player.x + 10, player.y - 10);
                    } else {
                        ctx.fillText(player.name, player.x + 10, player.y - 10);
                    }
                }
            }
        }
        
        function drawUI() {
            ctx.fillStyle = '#fff';
            ctx.font = '20px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('Puntuación: ' + score, 10, 30);
            ctx.fillText('Tiempo: ' + timeSurvived + ' seg', 10, 60);
            ctx.fillStyle = '#333';
            ctx.fillRect(canvas.width - 220, 10, 200, 25);
            const barWidth = (stability / 100) * 200;
            ctx.fillStyle = getStabilityColor(stability);
            ctx.fillRect(canvas.width - 220, 10, barWidth, 20);
            ctx.fillStyle = '#fff';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(Math.floor(stability) + '%', canvas.width - 120, 25);
        }
        
        function drawMessage() {
            ctx.fillStyle = '#fff';
            ctx.font = '30px Arial';
            ctx.textAlign = 'center';
            const lines = message.split('\n');
            for (let i = 0; i < lines.length; i++) {
                ctx.fillText(lines[i], canvas.width / 2, canvas.height / 2 + (i * 35));
            }
        }
        
        function drawEventEffects() {
            if (activeEvent.name === 'memeRain') {
                const progress = 1 - (eventTimer / activeEvent.duration);
                const count = 10;
                for (let i = 0; i < count; i++) {
                    const x = (canvas.width / count) * i + (canvas.width / count / 2);
                    const y = -50 + progress * (canvas.height + 100);
                    const emoji = ['😂', '😱', '🤣', '😜', '🤯'][i % 5];
                    ctx.font = '40px Arial';
                    ctx.fillText(emoji, x, y);
                }
            } else if (activeEvent.name === 'cosmicScream') {
                ctx.save();
                ctx.translate(Math.random() * 10 - 5, Math.random() * 10 - 5);
                ctx.fillStyle = 'rgba(255, 0, 0, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.restore();
            } else if (activeEvent.name === 'dramaPlanet') {
                const progress = Math.min(1, (activeEvent.duration - eventTimer) / 1000);
                const exitProgress = Math.max(0, (eventTimer - 2000) / 1000);
                const x = canvas.width + 100 - (progress * 300) + (exitProgress * 300);
                const y = canvas.height / 2;
                ctx.fillStyle = 'rgba(255, 0, 255, 0.7)';
                ctx.beginPath();
                ctx.arc(x, y, 100, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#fff';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('¡No eres suficiente!', x, y);
            }
        }
        
        function showGameOver() {
            document.getElementById('game-over').style.display = 'flex';
            document.getElementById('final-score').textContent = 'Puntuación Final: ' + score;
            document.getElementById('time-survived').textContent = 'Tiempo Sobrevivido: ' + timeSurvived + ' segundos';
            addChatMessage('Sistema: ' + username + ' explotó con ' + score + ' puntos');
            cancelAnimationFrame(animationId);
        }
        
        function getStabilityColor(value) {
            if (value <= 30) return 'rgb(255, 0, 0)';
            else if (value <= 60) return 'rgb(255, 255, 0)';
            else return 'rgb(0, 255, 0)';
        }
        
        function capitalize(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
    </script>
</body>
</html>
